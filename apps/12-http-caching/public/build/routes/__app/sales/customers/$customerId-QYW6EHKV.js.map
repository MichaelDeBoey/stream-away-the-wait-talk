{
  "version": 3,
  "sources": ["browser-route-module:/Users/kentcdodds/Desktop/stream-away-the-wait-talk/apps/12-http-caching/app/routes/__app/sales/customers/$customerId.tsx?browser", "../../../../../../app/routes/__app/sales/customers/$customerId.tsx"],
  "sourcesContent": ["export { CatchBoundary, default } from \"/Users/kentcdodds/Desktop/stream-away-the-wait-talk/apps/12-http-caching/app/routes/__app/sales/customers/$customerId.tsx\";", "import type { LoaderFunction, Deferrable } from \"@remix-run/node\";\nimport { deferred } from \"@remix-run/node\";\nimport {\n  Deferred,\n  Link,\n  useCatch,\n  useLoaderData,\n  useParams,\n} from \"@remix-run/react\";\nimport { ErrorFallback, InvoiceDetailsFallback } from \"~/components\";\nimport {\n  getCustomerInfo,\n  getCustomerInvoiceDetails,\n  shouldDeferInvoices,\n} from \"~/models/customer.server\";\nimport { requireUser } from \"~/session.server\";\nimport { currencyFormatter } from \"~/utils\";\n\ntype LoaderData = {\n  customerInfo: Awaited<ReturnType<typeof getCustomerInfo>>;\n  invoiceDetails: Deferrable<\n    NonNullable<Awaited<ReturnType<typeof getCustomerInvoiceDetails>>>\n  >;\n};\n\nexport const loader: LoaderFunction = async ({ request, params }) => {\n  const user = await requireUser(request);\n  const { customerId } = params;\n  if (typeof customerId !== \"string\") {\n    throw new Error(\"This should be unpossible.\");\n  }\n  const customerInfo = await getCustomerInfo(customerId);\n  if (!customerInfo) {\n    throw new Response(\"not found\", { status: 404 });\n  }\n  const invoiceDetailsPromise = getCustomerInvoiceDetails(customerId);\n  const deferInvoices = await shouldDeferInvoices({\n    customerId,\n    userId: user.id,\n  });\n  return deferred<LoaderData>(\n    {\n      customerInfo,\n      invoiceDetails: deferInvoices\n        ? invoiceDetailsPromise\n        : await invoiceDetailsPromise,\n    },\n    {\n      headers: {\n        \"Cache-Control\": \"max-age=10 stale-while-revalidate=5\",\n      },\n    }\n  );\n};\n\nconst lineItemClassName = \"border-t border-gray-100 text-[14px] h-[56px]\";\n\nexport default function CustomerRoute() {\n  const data = useLoaderData() as LoaderData;\n\n  return (\n    <div className=\"relative p-10\">\n      <div className=\"text-[length:14px] font-bold leading-6\">\n        {data.customerInfo.email}\n      </div>\n      <div className=\"text-[length:32px] font-bold leading-[40px]\">\n        {data.customerInfo.name}\n      </div>\n      <div className=\"h-4\" />\n      <div className=\"text-m-h3 font-bold leading-8\">Invoices</div>\n      <div className=\"h-4\" />\n      <Deferred\n        value={data.invoiceDetails}\n        fallback={<InvoiceDetailsFallback />}\n        errorElement={\n          <div className=\"relative h-full\">\n            <ErrorFallback />\n          </div>\n        }\n      >\n        {(invoiceDetails) => (\n          <table className=\"w-full\">\n            <tbody>\n              {invoiceDetails.map((details) => (\n                <tr key={details.id} className={lineItemClassName}>\n                  <td>\n                    <Link\n                      className=\"text-blue-600 underline\"\n                      to={`../../invoices/${details.id}`}\n                    >\n                      {details.number}\n                    </Link>\n                  </td>\n                  <td\n                    className={\n                      \"text-center uppercase\" +\n                      \" \" +\n                      (details.dueStatus === \"paid\"\n                        ? \"text-green-brand\"\n                        : details.dueStatus === \"overdue\"\n                        ? \"text-red-brand\"\n                        : \"\")\n                    }\n                  >\n                    {details.dueStatusDisplay}\n                  </td>\n                  <td className=\"text-right\">\n                    {currencyFormatter.format(details.totalAmount)}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        )}\n      </Deferred>\n    </div>\n  );\n}\n\nexport function CatchBoundary() {\n  const caught = useCatch();\n  const params = useParams();\n\n  if (caught.status === 404) {\n    return (\n      <div className=\"relative h-full\">\n        <ErrorFallback\n          message={`No customer found with the ID of \"${params.customerId}\"`}\n        />\n      </div>\n    );\n  }\n\n  throw new Error(`Unexpected caught response with status: ${caught.status}`);\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACAA;AAUA,sBAIO;AACP,qBAA4B;AAwC5B,IAAM,oBAAoB;AAEX,yBAAyB;AACtC,QAAM,OAAO;AAEb,SACE,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACb,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACZ,KAAK,aAAa,QAErB,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KACZ,KAAK,aAAa,OAErB,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,MACf,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,KAAgC,aAC/C,oCAAC,OAAD;AAAA,IAAK,WAAU;AAAA,MACf,oCAAC,UAAD;AAAA,IACE,OAAO,KAAK;AAAA,IACZ,UAAU,oCAAC,wBAAD;AAAA,IACV,cACE,oCAAC,OAAD;AAAA,MAAK,WAAU;AAAA,OACb,oCAAC,eAAD;AAAA,KAIH,CAAC,mBACA,oCAAC,SAAD;AAAA,IAAO,WAAU;AAAA,KACf,oCAAC,SAAD,MACG,eAAe,IAAI,CAAC,YACnB,oCAAC,MAAD;AAAA,IAAI,KAAK,QAAQ;AAAA,IAAI,WAAW;AAAA,KAC9B,oCAAC,MAAD,MACE,oCAAC,MAAD;AAAA,IACE,WAAU;AAAA,IACV,IAAI,kBAAkB,QAAQ;AAAA,KAE7B,QAAQ,UAGb,oCAAC,MAAD;AAAA,IACE,WACE,2BAEC,SAAQ,cAAc,SACnB,qBACA,QAAQ,cAAc,YACtB,mBACA;AAAA,KAGL,QAAQ,mBAEX,oCAAC,MAAD;AAAA,IAAI,WAAU;AAAA,KACX,kBAAkB,OAAO,QAAQ;AAAA;AAY/C,yBAAyB;AAC9B,QAAM,SAAS;AACf,QAAM,SAAS;AAEf,MAAI,OAAO,WAAW,KAAK;AACzB,WACE,oCAAC,OAAD;AAAA,MAAK,WAAU;AAAA,OACb,oCAAC,eAAD;AAAA,MACE,SAAS,qCAAqC,OAAO;AAAA;AAAA;AAM7D,QAAM,IAAI,MAAM,2CAA2C,OAAO;AAAA;",
  "names": []
}
